--Your integration test uses JdbcTemplate-based DAOs, so H2 must have all the tables they will query/insert/update.

CREATE TABLE trainers (
    trainer_id BIGINT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(255),
    email VARCHAR(255),
    password VARCHAR(255),
    contact VARCHAR(50),
    experience VARCHAR(100),
    skills VARCHAR(255),
    profile_pic VARCHAR(500),
    bio VARCHAR(1000),
    role VARCHAR(50),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE internship_batches (
    batch_code BIGINT AUTO_INCREMENT PRIMARY KEY,
    batch_name VARCHAR(255),
    course_name VARCHAR(255),
    trainer_id BIGINT,
    start_date DATE,
    end_date DATE,
    total_seats INT,
    available_seats INT,
     CONSTRAINT fk_tid FOREIGN KEY (trainer_id)
        REFERENCES trainers(trainer_id)
        ON DELETE CASCADE
        ON UPDATE CASCADE
);

CREATE TABLE users (
    user_id BIGINT AUTO_INCREMENT PRIMARY KEY,
    user_name VARCHAR(255),
    email VARCHAR(255),
    password VARCHAR(255),
    dob DATE,
    contact_no VARCHAR(50),
    address VARCHAR(255),
    college_name VARCHAR(255),
    grade VARCHAR(50),
    major VARCHAR(100),
    team VARCHAR(100),
    batch_code BIGINT,
    start_date DATE,
    end_date DATE,
    graduating_year INT,
    resume VARCHAR(500),
    profile_pic VARCHAR(500),
    role VARCHAR(50),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT fk_bc FOREIGN KEY (batch_code)
        REFERENCES internship_batches(batch_code)
        ON DELETE CASCADE
        ON UPDATE CASCADE
);



CREATE TABLE stipend (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    user_id BIGINT,
    user_name VARCHAR(255),
    payment_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    payment_mode VARCHAR(50),
    amount DOUBLE,CONSTRAINT fk_uid FOREIGN KEY (user_id)
        REFERENCES users(user_id)
        ON DELETE CASCADE
        ON UPDATE CASCADE
);

CREATE TABLE tasks (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    user_id BIGINT,
    description VARCHAR(1000),
    trainer_id BIGINT,
    status VARCHAR(50),
    deadline DATE,
    upload_file VARCHAR(500),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT fk_tasks_user FOREIGN KEY (user_id)
        REFERENCES users(user_id)
        ON DELETE CASCADE
        ON UPDATE CASCADE,
    CONSTRAINT fk_tasks_trainer FOREIGN KEY (trainer_id)
        REFERENCES trainers(trainer_id)
        ON DELETE CASCADE
        ON UPDATE CASCADE
);


CREATE TABLE feedback (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    user_id BIGINT,
    user_name VARCHAR(255),
    batch_code BIGINT,
    trainer_id BIGINT,
    trainer_name VARCHAR(255),
    date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    feedback VARCHAR(2000),
    rating INT,
    CONSTRAINT fk_tuser FOREIGN KEY (user_id)
        REFERENCES users(user_id)
        ON DELETE CASCADE
        ON UPDATE CASCADE,
    CONSTRAINT fk_trainer FOREIGN KEY (trainer_id)
        REFERENCES trainers(trainer_id)
        ON DELETE CASCADE
        ON UPDATE CASCADE,
        CONSTRAINT fk_b FOREIGN KEY (batch_code)
        REFERENCES internship_batches(batch_code)
        ON DELETE CASCADE
        ON UPDATE CASCADE
    
);

CREATE TABLE performance (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    user_id BIGINT,
    trainer_id BIGINT,
    batch_code BIGINT,
    trainer_name VARCHAR(255),
    remarks VARCHAR(2000),
    task_evaluation_score INT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT fk_tuser11 FOREIGN KEY (user_id)
        REFERENCES users(user_id)
        ON DELETE CASCADE
        ON UPDATE CASCADE,
    CONSTRAINT fk_trainer1 FOREIGN KEY (trainer_id)
        REFERENCES trainers(trainer_id)
        ON DELETE CASCADE
        ON UPDATE CASCADE,
        CONSTRAINT fk_b1 FOREIGN KEY (batch_code)
        REFERENCES internship_batches(batch_code)
        ON DELETE CASCADE
        ON UPDATE CASCADE
);

CREATE TABLE attendance (
    attendance_id BIGINT AUTO_INCREMENT PRIMARY KEY,
    user_id BIGINT,
    batch_code BIGINT,
    date DATE,
    present BOOLEAN,
    CONSTRAINT fk_tuser2 FOREIGN KEY (user_id)
        REFERENCES users(user_id)
        ON DELETE CASCADE
        ON UPDATE CASCADE,
  
        CONSTRAINT fk_b2 FOREIGN KEY (batch_code)
        REFERENCES internship_batches(batch_code)
        ON DELETE CASCADE
        ON UPDATE CASCADE
);INSERT INTO trainers (trainer_id, name, email, password, contact, experience, skills, bio, role)
VALUES (1, 'John Miller', 'john@trainer.com', 'pass123', '9876543210', '5 Years', 'Java, Spring', 'Senior Trainer', 'TRAINER');

INSERT INTO internship_batches (batch_code, batch_name, course_name, trainer_id, start_date, end_date, total_seats, available_seats)
VALUES(1001, 'Java Full Stack', 'Java', 1, '2025-12-01', '2026-03-01', 30, 25);

INSERT INTO users (user_id, user_name, email, password, dob, contact_no, address, college_name, grade, major, team, batch_code, start_date, end_date, graduating_year, resume, role)
VALUES(1, 'Sravya', 'sravya@user.com', 'pass123', '2002-05-10', '9876543210', 'Chennai', 'Vel Tech', 'A', 'CSE', 'Backend', 1001, '2025-01-01', '2025-03-01', 2025, 'resume.pdf', 'USER');

--INSERT INTO users (user_id, user_name, email, password, role)
--VALUES (1, 'Sravya', 'sravya@user.com', '$2a$10$7EqJtq98hPqEX7fNZaFWoOeJvYwYwYwYwYwYwYwYwYwYwYwYwYwYwYwYwYwYwYwYwYwYwYwYwYwYwYwYw
--', 'USER');
INSERT INTO users (user_id, user_name, email, password, role)
VALUES (99, 'Test Admin', 'existing@admin.com', '$2a$10$Dow1iFhZkYwYwYwYwYwYwOeJvYwYwYwYwYwYwYwYwYwYwYwYwYwYwYwYwYwYwYwYwYwYwYwYwYwYwYwYw
', 'ADMIN');

INSERT INTO internship_batches (batch_code, batch_name, course_name, trainer_id, start_date, end_date, total_seats, available_seats)
VALUES(1001, 'Java Full Stack', 'Java', 1, '2025-12-01', '2026-03-01', 30, 25);

INSERT INTO tasks (id, user_id, description, trainer_id, status, deadline, upload_file)
VALUES(1, 1, 'Build REST API', 1, 'PENDING', '2025-12-04', 'file.pdf');

INSERT INTO attendance (attendance_id, user_id, batch_code, date, present)
VALUES(1, 1, 1001, '2025-12-03', TRUE);

INSERT INTO performance (id, user_id, trainer_id, batch_code, trainer_name, remarks, task_evaluation_score)
VALUES(1, 1, 1, 1001, 'John Miller', 'Good progress', 90);

INSERT INTO feedback (id, user_id, user_name, batch_code, trainer_id, trainer_name, feedback, rating)
VALUES(1, 1, 'Sravya', 1001, 1, 'John Miller', 'Very helpful trainer', 5);

INSERT INTO stipend (id, user_id, user_name, payment_mode, amount)
VALUES(1, 1, 'Sravya', 'Cash', 3000.00);spring.datasource.url=jdbc:h2:mem:testdb;MODE=MySQL;DATABASE_TO_LOWER=TRUE
spring.datasource.driverClassName=org.h2.Driver
spring.datasource.username=h2
spring.datasource.password=h2

spring.jpa.hibernate.ddl-auto=none
spring.jpa.show-sql=true
spring.sql.init.mode=always
spring.jpa.database-platform=org.hibernate.dialect.H2Dialect
logging.level.org.springframework.jdbc.core.JdbcTemplate=DEBUG
logging.level.org.springframework.jdbc.core.StatementCreatorUtils=TRACE
logging:
  level:
    org.springframework.web: DEBUG
    org.springframework.validation: DEBUG


#Why?
#
#Makes tests use H2 in-memory database, not MySQL
#Makes tests completely safe \u2014 no real DB touched
#MODE=MySQL lets H2 accept MySQL-like SQL
#This file is loaded only when you run tests with:
#@ActiveProfiles("test")
